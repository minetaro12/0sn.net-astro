---
import { getEntry, render } from 'astro:content'
import BaseLayout from '../../../../layouts/BaseLayout.astro'
import { getSortedPosts } from '../../../../lib/posts'
import Icon from '../../../../components/Icon.astro'

export const getStaticPaths = async () => {
  const posts = await getSortedPosts()
  return posts.map((post) => ({
    params: {
      date: post.id.split('/')[0],
      post: post.id.split('/')[1],
    },
  }))
}

const { date, post } = Astro.params

const entry = await getEntry('posts', `${date}/${post}`)

if (!entry) {
  throw new Error(`Post not found: ${date}/${post}`)
}

const { Content } = await render(entry)
---

<BaseLayout title={entry.data.title} tags={entry.data.tags}>
  <div>
    <div class="flex flex-col gap-2">
      <h1 class="text-2xl font-bold">{entry.data.title}</h1>
      <div class="flex gap-2">
        {
          entry.data.tags.map((tag) => (
            <a
              href={`/tags/${tag}/`}
              class="bg-button hover:bg-button-hover rounded p-1 text-sm"
            >
              <Icon name="tag" />
              {tag}
            </a>
          ))
        }
      </div>
      <div class="text-sm">
        <Icon name="calendar" />
        {
          new Date(entry.data.date).toLocaleString('ja-JP', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
          })
        }
      </div>
      <div></div>
    </div>
    <div class="markdown-body post">
      <Content />
    </div>
  </div>
</BaseLayout>
